# AI Evaluations CURL Examples

# Zamień <activity_id> oraz <evaluation_id> na realne UUID.
# Domyślny użytkownik (stub) jest wstrzykiwany przez middleware; brak nagłówka Authorization.

# 1. Zlecenie nowej ewaluacji AI (POST) – pusty obiekt {}
curl -X POST http://localhost:3000/api/activities/<activity_id>/ai-evaluations \
  -H 'Accept: application/json' \
  -d '{}'

# Oczekiwany sukces (202): { "data": { "queued": true, "next_poll_after_sec": 5 } }

# 2. Próba ponownego zlecenia przed upływem cooldown (5 minut) – oczekiwany 429 AI_EVALUATION_COOLDOWN
curl -X POST http://localhost:3000/api/activities/<activity_id>/ai-evaluations \
  -H 'Accept: application/json' \
  -d '{}'

# 3. Lista wszystkich wersji ewaluacji dla aktywności (GET)
curl -X GET http://localhost:3000/api/activities/<activity_id>/ai-evaluations \
  -H 'Accept: application/json'

# Przykładowa odpowiedź: { "data": [ { "id": "...", "version": 1, "lore_score": 7, ... } ] }

# 4. Pobranie pojedynczej ewaluacji po ID
ycurl -X GET http://localhost:3000/api/ai-evaluations/<evaluation_id> \
  -H 'Accept: application/json'

# 5. Błędny UUID aktywności (VALIDATION_ERROR 400)
curl -X POST http://localhost:3000/api/activities/invalid-uuid/ai-evaluations \
  -H 'Accept: application/json' \
  -d '{}'

# 6. Błędny body (np. dodatkowe pola) – VALIDATION_ERROR 400
curl -X POST http://localhost:3000/api/activities/<activity_id>/ai-evaluations \
  -H 'Accept: application/json' \
  -d '{"unexpected": true}'

# 7. Watch/polling – pokazuje najnowszą ewaluację co 5 sekund
watch -n 5 "curl -s http://localhost:3000/api/activities/<activity_id>/ai-evaluations | jq '.data[0]'"

# 8. (Opcjonalne) Debug: wyświetlenie pełnej listy przy spamowaniu requestów
curl -s http://localhost:3000/api/activities/<activity_id>/ai-evaluations | jq '.data | length'

# 9. (Edge) Aktywność usunięta / nie istnieje – ACTIVITY_NOT_FOUND 404
curl -X GET http://localhost:3000/api/activities/00000000-0000-0000-0000-000000000000/ai-evaluations \
  -H 'Accept: application/json'

# 10. (Przykład) Filtrowanie surowe JSON dla tokenów z ostatniej ewaluacji
curl -s http://localhost:3000/api/activities/<activity_id>/ai-evaluations | jq '.data[0].tokens'
