---
import Layout from "@/layouts/Layout.astro";
import { GroupMembersView } from "@/components/groups/GroupMembersView";
import { Breadcrumb } from "@/components/navigation/Breadcrumb";
import type { ApiSingle, GroupDTO } from "@/types";

export const prerender = false;

const { group_id } = Astro.params;

if (!group_id) {
  Astro.response.status = 400;
  throw new Error("group_id is required");
}

// Fetch group details for breadcrumb
const groupUrl = new URL(`/api/groups/${group_id}`, Astro.url);
const groupRes = await fetch(groupUrl);

let groupDto: GroupDTO | null = null;
if (groupRes.ok) {
  const body = (await groupRes.json()) as ApiSingle<GroupDTO>;
  groupDto = body.data;
}
---

<Layout title="CzÅ‚onkowie grupy">
  <main class="mx-auto w-full max-w-5xl p-4 sm:p-6">
    <Breadcrumb items={[
      { label: "Lista grup", href: "/groups" },
      { label: groupDto?.name || "Grupa", href: `/groups/${group_id}/dashboard` }
    ]} />
    <!-- React hydration for interactive table & actions -->
    <GroupMembersView client:load groupId={group_id as any} />
  </main>
</Layout>


